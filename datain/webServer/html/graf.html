<!DOCTYPE html>
<html>
    <head>
        <title>client - WebSocket</title>
        <link href="/static/vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style>
    </style>
    </head>
    <body>
        <section>
            <header class="navbar sticky-top bg-dark flex-md-nowrap p-0 shadow" data-bs-theme="dark">
                <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6 text-white" href="#">Company name</a>
                <ul class="navbar-nav flex-row d-md-none">
                    <li class="nav-item text-nowrap">
                        <button class="nav-link px-3 text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSearch" aria-controls="navbarSearch" aria-expanded="false" aria-label="Toggle search">
                            <svg class="bi"><use xlink:href="#search"/></svg>
                        </button>
                    </li>
                    <li class="nav-item text-nowrap">
                        <button class="nav-link px-3 text-white" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
                            <svg class="bi"><use xlink:href="#list"/></svg>
                        </button>   
                    </li>
                </ul>
                <div id="navbarSearch" class="navbar-search w-100 collapse">
                    <input class="form-control w-100 rounded-0 border-0" type="text" placeholder="Search" aria-label="Search">
                </div>
            </header>

            <div class="container-fluid">
                <div class="row">
                    <aside class="col-md-3 col-lg-2">
                        <div class="accordion accordion-flush" id="accordionAside">
                            <div class="accordion-item">
                                <h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseControl" aria-expanded="false" aria-controls="flush-collapseControl">Control</button></h2>
                                <div id="flush-collapseControl" class="accordion-collapse collapse" data-bs-parent="#accordionAside">
                                    <div class="accordion-body">
                                        <ul>
                                            <li><a class="btn-send" data-href="/control/start" href="#">Start</a></li>
                                            <li><a class="btn-send" data-href="/control/stop" href="#">Stop</a></li>
                                        <ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-suscripciones" aria-expanded="false" aria-controls="flush-suscripciones">Accordion Item #2</button></h2>
                                <div id="flush-suscripciones" class="accordion-collapse collapse" data-bs-parent="#accordionAside">
                                    <div class="accordion-body">
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-xxxxx" aria-expanded="false" aria-controls="flush-xxxxx">Accordion Item #2</button></h2>
                                <div id="flush-xxxxx" class="accordion-collapse collapse" data-bs-parent="#accordionAside">
                                    <div class="accordion-body">
                                    </div>
                                </div>
                            </div>
                        </div>

                    </aside>
                    <main class="col-md-9 col-lg-10">
                        <div id="graf" style="min-height: 600px; background-color: #f00;"></div>
                    </main>
                </div>
            </div>

        </section>bootstrap.min.js

        <script src="/static/vendors/bootstrap/js/bootstrap.min.js"></script>
        <script src="/static/vendors/jquery/jquery.min.js"></script>
        <script type="text/javascript" src="/static/vendors/echarts/echarts.min.js"></script>
        <script type="text/javascript" src="/static/js/graf.js"></script>

<script>
var grafObj;

// var uri = {
//         'ws': "ws://0.0.0.0:8880/ws",
//         'base': 'http://0.0.0.0:8880',
//         "method": {
//             'control': {
//                 'start': '/control/start',
//                 'stop': '/control/stop',
//             }
//         }
// }
// var ws = new WebSocket(uri['ws']);


var __data=[
  {
    't': "2004-01-02",
    'o': 1,
    'c': 3,
    'l': 0.5,
    'h': 3.5,
    'v': 168,
    'x': true,
  },
  {
    't': "2004-01-05",
    'o': 3,
    'c': 5,
    'l': 2.5,
    'h': 5.5,
    'v': 221,
    'x': true,
  },
  {
    't': "2004-01-06",
    'o': 5,
    'c': 4,
    'l': 3.5,
    'h': 5.5,
    'v': 191,
  },
  {
    't': "2004-01-07",
    'o': 5,
    'c': 4,
    'l': 3.5,
    'h': 5.5,
    'v': 191,
  },
  {
    't': "2004-01-08",
    'o': 5,
    'c': 4,
    'l': 3.5,
    'h': 5.5,
    'v': 191,
  },
  {
    't': "2004-01-09",
    'o': 5,
    'c': 4,
    'l': 3.5,
    'h': 5.5,
    'v': 191,
  },
];

var __data2=[
    {
    "lastUpdateId": 1027024,
    "E": 1589436922972,   // Message output time
    "t": "2004-01-06",   // Transaction time
    "bids": [
        [ "4.2", "10" ],
        [ "4.1", "26" ],
        [ "4", "35" ],
    ],
    "asks": [
        [ "3.9", "50"],
        [ "3.8", "61"],
        [ "3.7", "70"],
        [ "1", "80"],
    ]
    }
];

var uri = {
    'ws': "ws://0.0.0.0:8880/ws",
    'base': 'http://0.0.0.0:8880',
    "method": {
        'control': {
            'start': '/control/start',
            'stop': '/control/stop',
        }
    }
}



(function($) {

    stream = new streamControl({
        'uri': uri
    })


    grid_precio = (new grid({'name': 'precio'})).setTemplate('principal', 'Precio');
    grid_volume = (new grid({'name': 'volume'})).setTemplate('principal', 'Volume');

    dataSet = new datasetKlineStream({
        symbol: '',
        websocket: null
    });
    //console.log(dataSet.configDatasets())

    serieKline = new serieKline();
    serieKline.setGrid(grid_precio);
    serieKline.setDataset(dataSet.getDatasetByName('kline'));
    serieVolume = new serieVolume();
    serieVolume.setGrid(grid_volume);
    serieVolume.setDataset(dataSet.getDatasetByName('volume'));


    grafObj = $('#graf').graf()
    grafObj.addDataset(dataSet);
    grafObj.addGrid(grid_precio);
    grafObj.addGrid(grid_volume);
    grafObj.addSerie(serieKline)
    grafObj.addSerie(serieVolume)
    grafObj.loadOptions();




    // const binanceSocket = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@kline_1m');

    // binanceSocket.onmessage = function (event) {
    //     let message = JSON.parse(event.data);
    //     let candlestick = message.k;
    //     console.log(candlestick)
    //     grafObj.loadSeries([candlestick])
    //     grafObj.updateGraf();
    // };

    // grafObj.loadSeries(__data)
    // grafObj.loadSeries(__data2)
    //grafObj.addDataset();
    //grafObj.updateGraf();
})(jQuery)



</script>



    </body>
</html>